<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="description" content="">
	<meta property="og:title" content="Size/speed of various MARC serializations using ruby-marc">
	<link rel="icon" href="http://robotlibrarian.billdueber.com/" />
	
	
		<title>Robot Librarian | Size/speed of various MARC serializations using ruby-marc</title>
		<meta property="og:type" content="article">
		<meta property="article:published_time" content= 2010-09-29 >
	
	<meta property="og:description" content="">
	<meta property="og:url" content="http://robotlibrarian.billdueber.com/2010/09/Size/speed-of-various-MARC-serializations-using-ruby-marc/">
	<meta property="og:site_name" content="Robot Librarian">
	
	<meta name="generator" content="Hugo 0.19" />
   
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">

	
	<link rel="stylesheet" href="http://robotlibrarian.billdueber.comcss/style.css">
	<link href="" rel="alternate" type="application/rss+xml" title="Robot Librarian" />
</head>
<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://robotlibrarian.billdueber.com">Robot Librarian</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="particles-js"></div>
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="http://robotlibrarian.billdueber.com">Robot Librarian</a></h1>
		
		
		
		
		
		<div id="social" class="text-center">
			
				
			
			
			
			
				
						
		</div>
		<div id="links" class="text-center">
			
			
		</div>
	</div>
</div>


		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>
	<header>
		<div class="panel-header">
			<h1>Size/speed of various MARC serializations using ruby-marc
				
			</h1>
			<div class="panel-footer">
				
			</div>
			
		</div>
	</header>
	<br>
	<HR align=center>
	<article>
		

<p><a href="http://dilettantes.code4lib.org/">Ross Singer</a> recently updated <a href="http://marc.rubyforge.org/">ruby-marc</a> to include a <code>#to_hash</code> method that creates a data structure that is (a) round-trippable without any data loss, and (b) amenable to serializing to JSON. He&rsquo;s calling it <em><a href="http://dilettantes.code4lib.org/blog/2010/09/a-proposal-to-serialize-marc-in-json/">marc-in-json</a></em> (even though the serialization is up to the programmer, it&rsquo;s expected most of us will use JSON), and I think it&rsquo;s the way to go in terms of JSON-able MARC data.</p>

<p>I wanted to take a quick look at the space/speed tradeoffs of using various means to serialize MARC records in the marc-in-json format compared to using binary MARC-21.</p>

<h3 id="why-bother">Why bother?</h3>

<p>Binary MARC-21 is &ldquo;broken&rdquo; in that a lot of us have records that are so long (more than 99,999 bytes) it&rsquo;s impossible to create a valid marc binary record. The standard alternative, MARC-XML, has huge filesizes (roughly 3 times as large) and runs a lot more slowly in every benchmark I&rsquo;ve ever run. For ruby-marc, the penalty for using XML is further exaggerated because the serializer is based on REXML and is super-slow.</p>

<p>There have been a few proposals for a MARC data structure that can easily be serialized to JSON (I had <a href="http://robotlibrarian.billdueber.com/new-interest-in-marc-hash-JSON/">my own</a>, in fact), but the stuff Ross has done with marc-in-json is preferable in being (a) not a ton bigger in terms of file size, and (b) much easier to query from a <a href="http://nosql-database.org/">NoSQL</a> database using something like <a href="http://goessner.net/articles/JsonPath/">JSONPath</a> or <a href="http://www.sitepen.com/blog/2008/07/16/JSONquery-data-querying-beyond-JSONpath/">JSONQuery</a>.</p>

<h3 id="what-i-m-testing">What I&rsquo;m testing</h3>

<p>For this test, I used:</p>

<ul>
<li><strong>marc21 binary</strong> This is the stock serialization / deserialization provided by ruby-marc.</li>
<li><strong>YAJL for JSON</strong> <a href="http://lloyd.github.com/yajl/">YAJL</a> is a very fast C-based JSON library. Here we&rsquo;re using the Ruby bindings and calling <code>Yajl::Encoder.encode(r.to_hash)</code> to serialize and <code>MARC::Record.new_from_hash(Yajl::Parser.parse(JSON))</code> to deserialize.</li>
<li><strong>Msgpack</strong> The <a href="http://msgpack.org/">Msgpack project</a> is explicitly designed to be &ldquo;binary JSON&rdquo; &ndash; smaller, faster, etc &ndash; at the expense of human readability/editabilty . Again, this used the ruby bindings.</li>
</ul>

<h3 id="the-benchmark-and-its-results">The benchmark and its results</h3>

<p>I&rsquo;m interested in how long it takes to serialize and deserialize <em>a single record</em>. My primary use-case is sticking a single record into Solr, and then pulling the string representation of that record out and turning it back into MARC.</p>

<p>It&rsquo;s entirely possible that trying to deal with a whole set of MARC records &ndash; as a JSON array of marc-in-json objects, or as a set of newline-delimited JSON (or perhaps <a href="https://en.wikipedia.org/wiki/Line_Delimited_JSON">LDJSON</a> or Msgpack objects &ndash; would yield different results. The former is especially interesting, since to parse a large JSON array one needs to use a streaming parser, which will almost certainly have a different profile in both processing and memory use.</p>

<p>The ambitious can see the <a href="https://gist.github.com/billdueber/601397">full source code of the benchmark</a>.</p>

<p>Note that the following represent only the performance of ruby-marc and the particular serializers used. Other platforms or other libraries will certainly give different results!</p>

<p>Total of 18880 records run 20 times (377,600 serialize/deserialize cycles per method) on my Mac OSX desktop; comparisons are to MARC21-Binary.</p>

<p>~~~</p>

<p>SERIALIZING
MARC Binary 357.02 s (100%)
YAJL 312.65 s ( 88%)
Msgpack 266.26 s ( 75%)</p>

<p>DESERIALIZING
MARC Binary 648.91 s (100%)
YAJL 507.64 s ( 78%)
Msgpack 459.73 s ( 71%)</p>

<p>SERIALIZE + DESERIALIZE
MARC Binary 1005.93 s (100%)
YAJL 820.29 s ( 82%)
Msgpack 725.99 s ( 72%)</p>

<p>SIZE
MARC Binary 31.15 MBytes (100%)
Msgpack 42.00 MBytes (135%)
JSON 55.99 MBytes (180%)
XML 93.42 MBytes (300%)</p>

<p>~~~~</p>

<h2 id="analysis-such-as-it-is">Analysis, such as it is</h2>

<p>Obviously, there are size/speed tradeoffs. Nothing is as small as binary MARC21, but both YAJL and Msgpack are faster &ndash; significantly so for deserialization, which happens to be where I want the speed for my uses.</p>

<p>At 80% larger, the JSON serialization is quite a big bigger, but it&rsquo;s a hell of a lot smaller than MARC-XML and suffers none of the limitations of binary MARC.</p>

<p>For a closed system (i.e., you&rsquo;re not worried about anyone else being able to read your data) such as a Blacklight installation, I&rsquo;d be tempted to move to using JSON sooner rather than later.</p>

	</article>
	<br>
	
</main>
	


						<br>
						<section id="footer">
							<div class="text-center center-block">
								<ul class="copyright">
									<li>&copy; 2017 <a target="_blank" href="http://robotlibrarian.billdueber.com"></a> | Powered by <a target="_blank" href="https://gohugo.io/">Gohugo</a> | Theme <a target="_blank" href="https://git.pofilo.fr/pofilo/hugo-fatboy">Fatboy</a></li>
								</ul>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	</div>
  
  
	
  
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>

	

	

	

	

	
	</body>
</html>





