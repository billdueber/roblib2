<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="description" content="">
	<meta property="og:title" content="MARC-Hash: a proposed format for JSON/YAML/Whatever-compatible MARC records ">
	<link rel="icon" href="http://robotlibrarian.billdueber.com/" />
	
	
		<title>Robot Librarian | MARC-Hash: a proposed format for JSON/YAML/Whatever-compatible MARC records </title>
		<meta property="og:type" content="article">
		<meta property="article:published_time" content= 2009-04-13 >
	
	<meta property="og:description" content="">
	<meta property="og:url" content="http://robotlibrarian.billdueber.com/2009/04/MARC-Hash-a-proposed-format-for-JSON/YAML/Whatever-compatible-MARC-records/">
	<meta property="og:site_name" content="Robot Librarian">
	
	<meta name="generator" content="Hugo 0.19" />
   
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">

	
	<link rel="stylesheet" href="http://robotlibrarian.billdueber.comcss/style.css">
	<link href="" rel="alternate" type="application/rss+xml" title="Robot Librarian" />
</head>
<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://robotlibrarian.billdueber.com">Robot Librarian</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="particles-js"></div>
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="http://robotlibrarian.billdueber.com">Robot Librarian</a></h1>
		
		
		
		
		
		<div id="social" class="text-center">
			
				
			
			
			
			
				
						
		</div>
		<div id="links" class="text-center">
			
			
		</div>
	</div>
</div>


		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>
	<header>
		<div class="panel-header">
			<h1>MARC-Hash: a proposed format for JSON/YAML/Whatever-compatible MARC records 
				
			</h1>
			<div class="panel-footer">
				
			</div>
			
		</div>
	</header>
	<br>
	<HR align=center>
	<article>
		<p>In my first shot at MARC-in-JSON, which I appropriately (and prematurely) named <a href="http://code.google.com/p/marc-json/">MARC-JSON</a>, I made a point of losing round-tripability (to and from MARC) in order to end up with a nice, easy-to-work-with data structure based mostly on hashes. &ldquo;Who really cares what order the subfields come in?&rdquo; I asked myself.</p>

<p>Well, of course, it turns out some people do. Some even care about the order of the tags. &ldquo;Only in the 500s&hellip;usually&rdquo; I was told today. All my lovely dreams of using easy-to-access hashes up in so much smoke.</p>

<p>So&hellip;I&rsquo;m suggesting we try something a little simpler. Something so brain-dead, in fact, that I&rsquo;m loathe to put it down because it&rsquo;s pretty much the obvious way to do it. To wit:</p>

<pre><code class="language-javascript">
{
  &quot;type&quot; : &quot;marc-hash&quot;,
  &quot;version&quot; : [1, 0],

  &quot;leader&quot; : &quot;leader string&quot;
  &quot;control&quot; : [
     [&quot;001&quot;, [&quot;all&quot;, &quot;001&quot;, &quot;values&quot;]],
     [&quot;002&quot;, [&quot;all&quot;, &quot;002&quot;, &quot;values&quot;]],
  ],
  &quot;data&quot; : [
    [&quot;010&quot;, &quot; &quot;, &quot; &quot;,
      [
        [&quot;a&quot;, &quot;68009499&quot;]
      ]
    ],
    [&quot;035&quot;, &quot; &quot;, &quot; &quot;,
      [
        [&quot;a&quot;, &quot;(RLIN)MIUG0000733-B&quot;]
      ],
    ]
    [&quot;035&quot;, &quot; &quot;, &quot; &quot;,
      [
        [&quot;a&quot;, &quot;(CaOTULAS)159818014&quot;]
      ],
    ]
    [&quot;245&quot;, &quot;1&quot;, &quot;0&quot;,
      [
        [&quot;a&quot;, &quot;Capitalism, primitive and modern;&quot;],
        [&quot;b&quot;, &quot;some aspects of Tolai economic growth&quot; ],
        [&quot;c&quot;, &quot;[by] T. Scarlett Epstein.&quot;]
      ]
    ]
  ]
}

</code></pre>

<p>Stupid MARC allows all the stupid fields to stupid repeat and be out of stupid order and such, so it&rsquo;s just a lot of arrays. Easily round-tripable.</p>

<p>Why bother? Excellent question, and one that&rsquo;s a little harder to answer now that the data structure requires so much looping to find anything (the first time, anyway). I guess it&rsquo;s still a lot easier than working with raw MARC (or, I would claim, MARC-XML), requires no special libraries in any language that supports strings, hashes, and arrays, and can be manipulated with basic language constructs.</p>

<p>A few things worth noting about the assumptions in my mind:</p>

<ul>
<li>By definition, it&rsquo;s always UTF-8. The leader should be changed to note this on the sending end, but it&rsquo;s not required.</li>
<li>We include both a type &ldquo;marc-hash&rdquo;, and a version with major/minor numbers.</li>
<li>Everything is a string.</li>
<li>Alpha characters in indicators/tags are all lowercased.</li>
<li>A control field is a duple: tag and array of values.</li>
<li>A data field has four values:

<ul>
<li>The tag</li>
<li>Indicator one</li>
<li>Indicator two</li>
<li>An array of duples: subfield and its value</li>
</ul></li>
</ul>

<p>##A simple transformation to make it a little more queryable</p>

<p>Let&rsquo;s say you don&rsquo;t give a damn about tags that appear out of order, because that&rsquo;s just a crime against nature, anyway. And you really don&rsquo;t care what order the subtags appear in most of the time, &lsquo;cause really, who does?</p>

<p>A simple run-through (psuedocode ahead):</p>

<pre><code class="language-perl">
  my marchash = getTheMarcHash();
  my kindamarc;
  kindamarc{leader} = marchash{leader};

  # Map the control fields by tag =&gt; array-of-values
  foreach cfield (marchash{control}) {
    kindamarc{control}{cfield[0] ||= []};
    kindamarc{control}{cfield[0]}.push(cfield[1]);
  }

  foreach d (marchash{data}) {
    (tag, ind1, ind1) = (d[0], d[1], d[2]);

    # build up a hash based on subfields for this tag
    newd = {};
    foreach subfield (d[3]) {
      (stag, sval) = subfield;
      newd{stag} = sval;
    }

    # Store the subfield hash in a few places so it's easy to find.
    foreach i1 ('*', ind1) {
      foreach i2 ('*', ind2) {
        kindamarc{data}{tag}{i1}{i2} ||= [];
        kindamarc{data}{tag}{i1}{i2}.push(newd);
      }
    }
  }

~~~~


Control fields are stored as arrays of values associated with the tag. Data fields are built up as a hash of subfield to array-of-values pairs, and then stored both based on the indicator given and the wildcard indicator '*'.

Basically, this will allow things like this:

~~~perl
  $leader = $kindamarc{leader};
  $first001 = $kindamarc{control}{&quot;001&quot;}[0];

  # Find 856s where indicator 2 is '1'

  @mystuff = $kindamarc{data}{856}{'*'}{1};  
</code></pre>

<p>It&rsquo;s easy to see how we could store the index from the original array to make it easy to find the original order, too.</p>

<p>For many, I&rsquo;m sure, the prospect of dealing with something like this is more daunting than just learning to use MARC-XML or using existing libraries to deal with straight MARC. But there seems to be a set of folks out there for whom this might be useful, so I&rsquo;m throwing it out there.</p>

	</article>
	<br>
	
</main>
	


						<br>
						<section id="footer">
							<div class="text-center center-block">
								<ul class="copyright">
									<li>&copy; 2017 <a target="_blank" href="http://robotlibrarian.billdueber.com"></a> | Powered by <a target="_blank" href="https://gohugo.io/">Gohugo</a> | Theme <a target="_blank" href="https://git.pofilo.fr/pofilo/hugo-fatboy">Fatboy</a></li>
								</ul>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	</div>
  
  
	
  
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>

	

	

	

	

	
	</body>
</html>





