<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="description" content="">
	<meta property="og:title" content="Running Blacklight under JRuby">
	<link rel="icon" href="http://robotlibrarian.billdueber.com/" />
	
	
		<title>Robot Librarian | Running Blacklight under JRuby</title>
		<meta property="og:type" content="article">
		<meta property="article:published_time" content= 2009-11-18 >
	
	<meta property="og:description" content="">
	<meta property="og:url" content="http://robotlibrarian.billdueber.com/2009/11/running-blacklight-under-jruby/">
	<meta property="og:site_name" content="Robot Librarian">
	
	<meta name="generator" content="Hugo 0.24.1" />
   
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">

	
	<link rel="stylesheet" href="http://robotlibrarian.billdueber.comcss/style.css">
	<link href="" rel="alternate" type="application/rss+xml" title="Robot Librarian" />
</head>
<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://robotlibrarian.billdueber.com">Robot Librarian</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="particles-js"></div>
	<div id="menu-content" class="vertical-align">
		<img src="/images/robot_alpha.png" class="center-block" alt="Cheesy picture of robot">
		
			<h1 class="text-center"><a href="http://robotlibrarian.billdueber.com">Robot Librarian</a></h1>
		
		
		
			<small class="text-center center-block">Bill Dueber</small>
		
		
		
		<div id="social" class="text-center">
			<a href="https://twitter.com/billdueber" target="_blank"><i class="fa fa-twitter fa-2x"></i></a>
				
			
			
			
			<a href="https://github.com/https://github.com/billdueber" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
			
				
			<a href="mailto:bill@dueber.com" target="_blank"><i class="fa fa-envelope fa-2x"></i></a>			
		</div>
		<div id="links" class="text-center">
			
			
		</div>
	</div>
</div>


		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>
	<header>
		<div class="panel-header">
			<h1>Running Blacklight under JRuby
				
			</h1>
			<div class="panel-footer">
				
			</div>
			
		</div>
	</header>
	<br>
	<HR align=center>
	<article>
		

<p>I decided to see if I could get <a href="http://projectblacklight.org/">Blacklight</a> working under <a href="http://jruby.org/">JRuby</a>, starting with running the test suite and working my way up from there.</p>

<p>There was much pain. Much, much pain. Exacerbated by my almost complete
lack of knowledge about what I was doing.</p>

<p>This is the procedure I eventually arrived at &ndash; if there are places where I made trouble for myself, please let me know!</p>

<p>[And does anyone know how to get jruby&rsquo;s nokogiri to link to a different
libxml and stop with the crappy libxml2-version error message every time I
run it under OSX???]</p>

<h3 id="download-jruby">Download jruby</h3>

<p>Go to <a href="http://jruby.org/">jruby.org</a> and download a binary distribution. Extract the tar.gz (or zip or whatever)</p>

<p>I&rsquo;ll put mine in ~/jruby. Or, at least that&rsquo;s what I&rsquo;ll tell you.</p>

<pre><code>tar xzf jruby-1.4.tar.gz
</code></pre>

<p>To avoid confusion, let&rsquo;s make <em>jrake</em> an alias for <em>rake</em> and add the jruby bin directory to the path</p>

<pre><code>cd ~/jruby/bin
ln -s rake jrake
export PATH=`pwd`:$PATH
</code></pre>

<h3 id="download-blacklight">Download Blacklight</h3>

<pre><code>git clone git://github.com/projectblacklight/blacklight.git
</code></pre>

<p>Again, well say that I put this in <em>~/blacklight/</em></p>

<h3 id="muck-with-blacklight-dependencies">Muck with Blacklight dependencies</h3>

<p>Edit the file <em>init.rb</em> to comment out references to <em>libxml</em> and <em>ruby-xslt</em>,
as well as <em>nokogiri</em>. My understanding is that the first two are used, at this point, only for the EAD stuff. Both rely on <em>libxml2</em> which is a C-extension and hence unavailable to JRuby.</p>

<p>Nokogiri gets pulled in during other installs and for some reason jrake will complain later on that it&rsquo;s got a wrong version or something. So, we&rsquo;ll just work without that particular net for now.</p>

<pre><code>#### File ~/blacklight/init.rb
# config.gem 'libxml-ruby', :lib=&gt;'libxml', :version=&gt;'1.1.3'
# config.gem 'ruby-xslt', :lib=&gt;'xml/xslt', :version=&gt;'0.9.6'
# config.gem 'nokogiri', :version=&gt;'1.3.3'
</code></pre>

<h3 id="do-some-initial-installs">Do some initial installs</h3>

<pre><code>jgem install -v=2.3.4 rails
jgem install activerecord-jdbc-adapter jdbc-sqlite3
             activerecord-jdbcsqlite3-adapter ActiveRecord-JDBC
jgem install rcov -s http://gemcutter.org --no-rdoc --no-ri
jrake
jrake gems:install
</code></pre>

<h3 id="edit-the-config-database-yml-file">Edit the <em>config/database.yml</em> file</h3>

<p>&hellip;to change the adapter to <em>jdbcsqlite3</em> for development and testing.</p>

<h3 id="edit-the-databases-rake-file">Edit the <em>databases.rake</em> file</h3>

<p>This one was harder to track down. The default rake task has hard-coded database names in the .rake file &ndash; jdbcsqlite3 isn&rsquo;t included. I keep seeing things saying, &ldquo;Oh, yeah, that&rsquo;s been fixed&hellip;&rdquo; but, well, it wasn&rsquo;t for me. I had to do it by hand.</p>

<pre><code>edit ~/jruby/lib/ruby/gems/1.8/gems/rails-2.3.4/lib/tasks/databases.rake
</code></pre>

<p>You need to find everywhere there&rsquo;s a</p>

<pre><code>when &quot;sqlite&quot;, &quot;sqlite3&quot; # or when /^sqlite/ in one case
</code></pre>

<p>&hellip;and change it to</p>

<pre><code>when &quot;sqlite&quot;, &quot;sqlite3&quot;, &quot;jdbcsqlite3&quot;
</code></pre>

<p>Repeat for other databases you want to use (e.g., mysql). For the moment, since I&rsquo;m only worried about running <em>jrake spec</em>, that&rsquo;s all I&rsquo;m gonna do.</p>

<h3 id="try-again">Try again</h3>

<pre><code>jrake
  Missing these required gems:
   mislav-hanna  = 0.1.11
</code></pre>

<p>OK. Not sure why that didn&rsquo;t come in before. Go head and add it.</p>

<pre><code>jgem install  mislav-hanna
</code></pre>

<h3 id="migrate-the-databases">Migrate the databases</h3>

<pre><code>jrake
</code></pre>

<p>The databases should migrate, and then it&rsquo;ll poop out because Solr didn&rsquo;t start.</p>

<h3 id="fire-up-solr">Fire up solr</h3>

<p>Since we&rsquo;re running jruby, accessing the shell doesn&rsquo;t work. You&rsquo;ll have to fire up your test solr instance by hand.</p>

<pre><code>cd ~/blacklight/jetty
java -Djetty.port=8888 -jar start.jar 2&gt;log.jetty
</code></pre>

<h3 id="try-it-again">Try it again!</h3>

<pre><code>cd ~/blacklight
jrake spec

   ................................................................
   ................................................................
   ....F............................................................
   1)
   'ApplicationHelper Export EndNote should render the correct
   EndNote text file' FAILED
   expected: &quot;%0 Format\n%E Greer, Lowell. \n%E Lubin, Steven. \n%E Chase, Stephanie, \n%E Brahms, Johannes, \n%E Beethoven, Ludwig van, \n%E Krufft, Nikolaus von, \n%T Music for horn \n%I Harmonia Mundi USA, \n%C [United States] : \n%D p2001. \n&quot;,
  got: &quot;%0 Format\n%C [United States] : \n%D p2001. \n%E Greer, Lowell. \n%E Lubin, Steven. \n%E Chase, Stephanie, \n%E Brahms, Johannes, \n%E Beethoven, Ludwig van, \n%E Krufft, Nikolaus von, \n%I Harmonia Mundi USA, \n%T Music for horn \n&quot; (using ##)
./spec/helpers/application_helper_spec.rb:128:

Finished in 15.519 seconds
193 examples, 1 failure
</code></pre>

<p>I can live with that for the moment. Anyone know why that spec fails?</p>

<h3 id="great-how-about-the-features">Great! How about the features?</h3>

<pre><code>jrake features
  (much output)

  59 scenarios (59 passed)
  434 steps (434 passed)
  0m51.186s
</code></pre>

<h3 id="and-so">And so&hellip;</h3>

<p>&hellip;it appears that, at least on the surface, jruby is a viable platform for Blacklight so long as I don&rsquo;t actually need any of the <em>libxml</em> stuff. In the next couple days I&rsquo;ll try and actually get it all up and running and see if I can break it.</p>

	</article>
	<br>
	
</main>
	


						<br>
						<section id="footer">
							<div class="text-center center-block">
								<ul class="copyright">
									<li>&copy; 2017 <a target="_blank" href="http://robotlibrarian.billdueber.com"></a> | Powered by <a target="_blank" href="https://gohugo.io/">Gohugo</a> | Theme <a target="_blank" href="https://git.pofilo.fr/pofilo/hugo-fatboy">Fatboy</a></li>
								</ul>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	</div>
  
  
	
  
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>

	

	

	

	

	
	</body>
</html>





