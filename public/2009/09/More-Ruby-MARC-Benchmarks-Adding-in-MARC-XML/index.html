<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="description" content="">
	<meta property="og:title" content="More Ruby MARC Benchmarks: Adding in MARC-XML">
	<link rel="icon" href="http://robotlibrarian.billdueber.com/" />
	
	
		<title>Robot Librarian | More Ruby MARC Benchmarks: Adding in MARC-XML</title>
		<meta property="og:type" content="article">
		<meta property="article:published_time" content= 2009-09-18 >
	
	<meta property="og:description" content="">
	<meta property="og:url" content="http://robotlibrarian.billdueber.com/2009/09/More-Ruby-MARC-Benchmarks-Adding-in-MARC-XML/">
	<meta property="og:site_name" content="Robot Librarian">
	
	<meta name="generator" content="Hugo 0.19" />
   
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">

	
	<link rel="stylesheet" href="http://robotlibrarian.billdueber.comcss/style.css">
	<link href="" rel="alternate" type="application/rss+xml" title="Robot Librarian" />
</head>
<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://robotlibrarian.billdueber.com">Robot Librarian</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="particles-js"></div>
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="http://robotlibrarian.billdueber.com">Robot Librarian</a></h1>
		
		
		
		
		
		<div id="social" class="text-center">
			
				
			
			
			
			
				
						
		</div>
		<div id="links" class="text-center">
			
			
		</div>
	</div>
</div>


		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>
	<header>
		<div class="panel-header">
			<h1>More Ruby MARC Benchmarks: Adding in MARC-XML
				
			</h1>
			<div class="panel-footer">
				
			</div>
			
		</div>
	</header>
	<br>
	<HR align=center>
	<article>
		

<p>It turns out that UVA&rsquo;s reluctance to use the raw MARC data on the search results screen is driven more by processing time than parsing time. Even if they were to start with a fully-parsed MARC object, they&rsquo;re doing enough screwing around with that data that the bottleneck on their end appears to be all the regex and string processing, not the parsing. Their specs for what gets displayed are complex enough that they want to do the work up-front.</p>

<p>But I remain interested, at least partially because of the reason UVA is using MARC-XML: they have MARC records too big for binary MARC format to handle. We do, too, and we&rsquo;ve just been talking about what to do with them. So I&rsquo;m thinking that</p>

<p>First, I spent some time dusting off my first attempt at ruby programming: modifying ruby-marc to use libxml if it&rsquo;s available. It&rsquo;s not super-well tested, but I&rsquo;m pretty sure it works. And the speed increases are &hellip; well, see below.</p>

<p>Anyone who wants to mess with my <a href="http://github.com/billdueber/BillDueber-ruby-marc">attempt at libxml-enabled ruby-marc</a> is welcome to do so. This is a <em>very</em> forgiving parser &ndash; it trusts that whatever ended up in the XML should, in fact, have been there. If you say &lsquo;XXE&rsquo; is a control field, well, I&rsquo;ll treat it as a control field.</p>

<p>But back to the data. A few points are obvious:</p>

<ul>
<li>XML with REXML is dead-slow on both platforms (at least an order of magnitude slower )</li>
<li>XML with LibXML is competitive with binary MARC (within 20% or so)</li>
<li>Even with REXML, though, time to create MARC records out of the 50 input strings is less than a second, which might be ok depending on your application.</li>
</ul>

<h3 id="full-results">Full results</h3>

<p>As with last time, the <em>total</em> numbers below show how long it took to process all 40 sets of 50 records. The unadorned numbers are the <em>average time it took to process a set of 50 records</em>.</p>

<h4 id="call-up-solr-with-a-null-search-get-2000-records-back-in-batches-of-50-with-wt-ruby-eval-it-and-stick-it-into-arrays">Call up solr with a null search, get 2000 records back in batches of 50 with wt=ruby, eval it, and stick it into arrays</h4>

<pre><code>jruby-Get/Eval data              0.143550
mri-Get/Eval data                0.106550

jruby-Get/Eval data (total)      5.742000
mri-Get/Eval data (total)        4.262017
</code></pre>

<h4 id="turn-raw-strings-into-marc-record-objects-from-marc-binary-strings-joining-all-the-returned-marc-together-first">Turn raw strings into MARC::Record objects from MARC-Binary strings, joining all the returned MARC together first</h4>

<pre><code>jruby-marc4j-multistring         0.026575
jruby-marc-multistring           0.037175
mri-marc-multistring             0.073396

jruby-marc4j-multistring (total) 1.063000
jruby-marc-multistring (total)   1.487000
mri-marc-multistring (total)     2.935842
</code></pre>

<h4 id="turn-raw-strings-into-marc-record-objects-from-marc-xml">Turn raw strings into MARC::Record objects from MARC-XML</h4>

<pre><code>mri-marc-LibXML                  0.091332
jruby-marc-REXML                 0.799500
mri-marc-REXML                   0.948549

mri-marc-LibXML (total)          3.653276
jruby-marc-REXML (total)        31.980000
mri-marc-REXML (total)          37.941975
</code></pre>

<h3 id="conclusions">Conclusions</h3>

<p>I&rsquo;m not sure exactly where this leaves me, other than knowing that marc-xml is probably a viable alternative if you can use libxml. Getting a version of that code which uses native Java XML libraries when run under jruby  might be a useful exercise.</p>

	</article>
	<br>
	
</main>
	


						<br>
						<section id="footer">
							<div class="text-center center-block">
								<ul class="copyright">
									<li>&copy; 2017 <a target="_blank" href="http://robotlibrarian.billdueber.com"></a> | Powered by <a target="_blank" href="https://gohugo.io/">Gohugo</a> | Theme <a target="_blank" href="https://git.pofilo.fr/pofilo/hugo-fatboy">Fatboy</a></li>
								</ul>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	</div>
  
  
	
  
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>

	

	

	

	

	
	</body>
</html>





