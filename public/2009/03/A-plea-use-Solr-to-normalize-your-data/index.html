<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="description" content="">
	<meta property="og:title" content="A plea: use Solr to normalize your data">
	<link rel="icon" href="http://robotlibrarian.billdueber.com/" />
	
	
		<title>Robot Librarian | A plea: use Solr to normalize your data</title>
		<meta property="og:type" content="article">
		<meta property="article:published_time" content= 2009-03-30 >
	
	<meta property="og:description" content="">
	<meta property="og:url" content="http://robotlibrarian.billdueber.com/2009/03/a-plea-use-solr-to-normalize-your-data/">
	<meta property="og:site_name" content="Robot Librarian">
	
	<meta name="generator" content="Hugo 0.24.1" />
   
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">

	
	<link rel="stylesheet" href="http://robotlibrarian.billdueber.comcss/style.css">
	<link href="" rel="alternate" type="application/rss+xml" title="Robot Librarian" />
</head>
<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://robotlibrarian.billdueber.com">Robot Librarian</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="particles-js"></div>
	<div id="menu-content" class="vertical-align">
		<img src="/images/robot_alpha.png" class="center-block" alt="Cheesy picture of robot">
		
			<h1 class="text-center"><a href="http://robotlibrarian.billdueber.com">Robot Librarian</a></h1>
		
		
		
			<small class="text-center center-block">Bill Dueber</small>
		
		
		
		<div id="social" class="text-center">
			<a href="https://twitter.com/billdueber" target="_blank"><i class="fa fa-twitter fa-2x"></i></a>
				
			
			
			
			<a href="https://github.com/https://github.com/billdueber" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
			
				
			<a href="mailto:bill@dueber.com" target="_blank"><i class="fa fa-envelope fa-2x"></i></a>			
		</div>
		<div id="links" class="text-center">
			
			
		</div>
	</div>
</div>


		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>
	<header>
		<div class="panel-header">
			<h1>A plea: use Solr to normalize your data
				
			</h1>
			<div class="panel-footer">
				
			</div>
			
		</div>
	</header>
	<br>
	<HR align=center>
	<article>
		<p>[Only, of course, if you&rsquo;re using Solr. Otherwise, that&rsquo;d be dumb.]</p>

<p>We&rsquo;ve been working on <a title="Mirlyn2-Beta Library Catalog at the University of Michigan University LIbrary" href="http://mirlyn2-beta.lib.umich.edu/">Mirlyn2-Beta</a>, our installation of VuFind for some time now (don&rsquo;t let the fancy-pants name scare you off), and the further we get into it, the more obvious it is that I want to move as much data normalization into Solr itself as possible.</p>

<p>Arguments about how much business logic to move into the database layer, in the form of foreign-key requirements, cascading inserts and deletes, stored procedures, etc. are as old as the features themselves. Solid arguments for and against are made on all sides, and like all things, there&rsquo;s a happy middle ground for most people. [1. &ldquo;Most,&rdquo; in this case, excluding the old-time MySQL fanboys who took it as gospel that all data validation and manipulation belongs in the application layer, because their &ldquo;database&rdquo; didn&rsquo;t do any of it. Februrary 30th in a date field, anyone?]</p>

<p>But Solr provides an incredibly compelling use case because it allows for data transformation at both index and query time via the use of custom analyzers (or a standard analyzer with text filters applied). We&rsquo;re starting to migrate our schema to use more and more of these things, and I even went so far as to create a custom text filter for LCCNs after being <a href="http://bibwild.wordpress.com/2009/03/11/normalize-your-lccns/">inspired by Jonathan Rochkind.</a></p>

<p>The incentive is easy to see: client diversity. Let a thousand interfaces bloom, if you can give them all access to the same underlying Solr instance. And, seriously, how many times are you going to write that regexp to semi-normalize ISBNs and ISSNs, huh? Enough already.</p>

<p>If you&rsquo;re using a Solr nightly (and, really, you should be &ndash; faceting is <em>so</em> much faster than the official 1.3 release) you have access to regexp-based filters as well, which makes stuff like this really, really easy:</p>

<pre><code class="language-xml">
   &lt;!-- Simple type to normalize isbn/issn/other standard numbers --&gt;
    &lt;fieldType name=&quot;stdnum&quot; class=&quot;solr.TextField&quot; sortMissingLast=&quot;true&quot; omitNorms=&quot;true&quot; &gt;
      &lt;analyzer&gt;
        &lt;tokenizer class=&quot;solr.KeywordTokenizerFactory&quot;/&gt;
        &lt;filter class=&quot;solr.LowerCaseFilterFactory&quot;/&gt;
        &lt;filter class=&quot;solr.TrimFilterFactory&quot;/&gt;
        &lt;filter class=&quot;solr.PatternReplaceFilterFactory&quot;
             pattern=&quot;^0*([\d\-\.]+[xX]?).*$&quot; replacement=&quot;$1&quot;
        /&gt;
        &lt;filter class=&quot;solr.PatternReplaceFilterFactory&quot;
             pattern=&quot;[\-\.]&quot; replacement=&quot;&quot;  replace=&quot;all&quot;
        /&gt;
      &lt;/analyzer&gt;
    &lt;/fieldType&gt;


</code></pre>

<p>Here, we use the <em>KeywordTokenizerFactory</em> which, not so intuitively, produces a single token from the input. Then lowercase it and pull of any leading and trailing spaces (Trim).</p>

<p>For those of you that don&rsquo;t read regexp, we then match anything that looks like:</p>

<ol>
<li>Any number of leading zeros</li>
<li>&hellip;followed by any number of digits, dashes, or periods and an optional &lsquo;X&rsquo;</li>
<li>&hellip;followed by&hellip;well, we don&rsquo;t care. Anything else.</li>
</ol>

<p>&hellip;and throw away all but the stuff in #2. Then take <em>that</em> and throw away all the dashes and dots, and you&rsquo;re left with a string of numbers.</p>

<p>The beauty is that it happens both while the index is being made <em>and</em> during query time, so if your user types in &ldquo; 123-45-6-X  &rdquo; it will be normalized to 123456x, and then checked against your index.</p>

<p>This is simple stuff, and probably doesn&rsquo;t deserve the virtual ink I&rsquo;m providing for it, but Vufind out of the box doesn&rsquo;t do any of this sort of thing (likely because &ldquo;the box&rdquo; existed before it was super-easy to do this), and we all should be doing it.</p>

	</article>
	<br>
	
</main>
	


						<br>
						<section id="footer">
							<div class="text-center center-block">
								<ul class="copyright">
									<li>&copy; 2017 <a target="_blank" href="http://robotlibrarian.billdueber.com"></a> | Powered by <a target="_blank" href="https://gohugo.io/">Gohugo</a> | Theme <a target="_blank" href="https://git.pofilo.fr/pofilo/hugo-fatboy">Fatboy</a></li>
								</ul>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	</div>
  
  
	
  
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>

	

	

	

	

	
	</body>
</html>





