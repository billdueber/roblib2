<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="description" content="">
	<meta property="og:title" content="Normalizing LoC Call Numbers for sorting">
	<link rel="icon" href="http://robotlibrarian.billdueber.com/" />
	
	
		<title>Robot Librarian | Normalizing LoC Call Numbers for sorting</title>
		<meta property="og:type" content="article">
		<meta property="article:published_time" content= 2008-11-13 >
	
	<meta property="og:description" content="">
	<meta property="og:url" content="http://robotlibrarian.billdueber.com/2008/11/normalizing-loc-call-numbers-for-sorting/">
	<meta property="og:site_name" content="Robot Librarian">
	
		<meta property="og:tags" content="callnumbers">
	
		<meta property="og:tags" content="code">
	
	<meta name="generator" content="Hugo 0.24.1" />
   
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">

	
	<link rel="stylesheet" href="http://robotlibrarian.billdueber.comcss/style.css">
	<link href="" rel="alternate" type="application/rss+xml" title="Robot Librarian" />
</head>
<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://robotlibrarian.billdueber.com">Robot Librarian</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="particles-js"></div>
	<div id="menu-content" class="vertical-align">
		<img src="/images/robot_alpha.png" class="center-block" alt="Cheesy picture of robot">
		
			<h1 class="text-center"><a href="http://robotlibrarian.billdueber.com">Robot Librarian</a></h1>
		
		
		
			<small class="text-center center-block">Bill Dueber</small>
		
		
		
		<div id="social" class="text-center">
			<a href="https://twitter.com/billdueber" target="_blank"><i class="fa fa-twitter fa-2x"></i></a>
				
			
			
			
			<a href="https://github.com/https://github.com/billdueber" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
			
				
			<a href="mailto:bill@dueber.com" target="_blank"><i class="fa fa-envelope fa-2x"></i></a>			
		</div>
		<div id="links" class="text-center">
			
			
		</div>
	</div>
</div>


		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>
	<header>
		<div class="panel-header">
			<h1>Normalizing LoC Call Numbers for sorting
				
			</h1>
			<div class="panel-footer">
				
					<small class="text-muted">
						
						
							<font size="4"><a href="http://robotlibrarian.billdueber.comtags/callnumbers"><span class="label label-success">callnumbers</span></a></font>
						
							<font size="4"><a href="http://robotlibrarian.billdueber.comtags/code"><span class="label label-success">code</span></a></font>
						
					</small>
				
			</div>
			
		</div>
	</header>
	<br>
	<HR align=center>
	<article>
		<p><strong>Updated</strong>: <em>I missed a &lsquo;?&rsquo; in the original code that pushed a single cutter into the second-cutter position. Fixed below.</em></p>

<p><strong>Crap. Update 2</strong>: Initial letters can be three characters long. Regexp and output changed.</p>

<p>LoC Call numbers tend to be a mess, and I&rsquo;ve been working this morning trying to normalize them for easy string comparison.</p>

<p>The perl function below takes a call number (with some level of sloppiness) and returns a string suitable for comparisons with other strings returned by the function. It outputs stuff like this:</p>

<pre><code>
E                          E 0000.0000  0000  0000
E 184 .A1 G78              E 0184.0000A 1000G 7800
E184.A2 G78 1967           E 0184.0000A 2000G 7800 1967
E184.A2 G78 1970           E 0184.0000A 2000G 7800 1970
EA                         EA0000.0000  0000  0000
EA 10                      EA0010.0000  0000  0000
EA 10 1970                 EA0010.0000  0000  0000 1970
EA10 B7                    EA0010.0000B 7000  0000
EA 10.B7.G8                EA0010.0000B 7000G 8000
EA10.5                     EA0010.5000  0000  0000

~~~~

The code, in perl, follows:

~~~perl

sub normalizeLC {
  my $lc = uc(shift);
  $lc =~ /^
          \s*
          ([A-Z]{1,3})  # alpha
          \s*
          (         # optional numbers
            \d+
            (?: \s*\.\s*\d+)?  # ...with optional decimal point
          )?
          \s*
          (?:               # optional cutter
            \.? \s*
            ([A-Z]+)      # cutter letter
            \s*
            (\d+)?        # cutter numbers
          )?
          (?:               # optional cutter
            \.? \s*
            ([A-Z]+)      # cutter letter
            \s*
            (\d+)?        # cutter numbers
          )?
          \s*
          (.*?)            # everthing else
          \s*$
        /x;
  my ($alpha, $num, $c1alpha, $c1num, $c2alpha, $c2num, $extra) = ($1, $2, $3, $4, $5, $6, $7);
  $c1num .= 0 x (4 - length($c1num)); # Pad out to four decimal places
  $c2num .= 0 x (4 - length($c2num)); # ditto
  $extra = ' ' . $extra if ($extra);
  return sprintf(&quot;%-3s%09.4f%-2s%4s%-2s%4s%s&quot;, $alpha, $num, $c1alpha, $c1num, $c2alpha, $c2num, $extra);
}
</code></pre>

	</article>
	<br>
	
</main>
	


						<br>
						<section id="footer">
							<div class="text-center center-block">
								<ul class="copyright">
									<li>&copy; 2017 <a target="_blank" href="http://robotlibrarian.billdueber.com"></a> | Powered by <a target="_blank" href="https://gohugo.io/">Gohugo</a> | Theme <a target="_blank" href="https://git.pofilo.fr/pofilo/hugo-fatboy">Fatboy</a></li>
								</ul>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	</div>
  
  
	
  
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>

	

	

	

	

	
	</body>
</html>





